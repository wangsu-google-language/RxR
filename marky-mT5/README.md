# Marky-mT5

## Data types

We release two sections of RxR Marky data:

**RxR**: This includes the three data splits `rxr_train`/`rxr_val_seen`/`val_unseen` in the original RxR data. In the Marky paper, this corresponds to the Silver landmarks. 
**RxR-marky_train**: This includes instructions generated by Marky pipeline on the ~330k paths sampled from the RxR train environments. For each path, an instruction is generated in English, Hindi and Telugu, coming to the total of ~1M data items.

For the convenience of the user, we adopt the same format for both types of data, which matches the RxR data format wherever possible (details in the Data fields section).

## Data format & download

The data will be released in JSON Lines format, and download with the [gsutil](https://cloud.google.com/storage/docs/gsutil_install#install) toolkit:
```
gsutil cp gs://rxr-data/marky_open_{train/val_seen/val_unseen/marky_train}.jsonl
```

## Data fields

For the RxR silver landmarks (including train/val_seen/val_unseen splits)

Each line in the jsonl data is a data item containing information about a single navigation path, with the following data fields available:

* language (str) Language tag, `en`/`hi`/`te` for English/Hindi/Telugu.
* path_id (int) Unique path identifier. Only provided for RxR-marky_train split because for the train/val_seen/val_unseen (silver) this already exists in the original RxR data.
* instruction_id (int) Instruction unique identifier. Maps into `instruction_id` field in the Guide data.
* instruction (str) Instruction text, generated by Marky-mT5. 
* split (str) Data split identifier, in `train`, `val_seen`, `val_unseen`.
* heading (float) Agent’s initial heading.
* scan (str) Scan ID for Matterport3D environment. 
* text_spans: (List[str]) Text spans aligned to landmark images. Note it's only available for silver landmark data, not inferred data, because the text-spans are parsed from human-written reference, and inferred data do not have the reference. 
* text_spans_chars_start_indices (List[int]) Start char indices of text spans. As above, only available in silver landmark data.
* text_spans_chars_end_indices (List[int]) End char indices of text spans. As above, only available in silver landmark data.
* landmark_bbox_coords: (List[List[float]]) Bounding boxes that identify landmark images from context panoramas. Each bbox is a list of 4 floats [ymin, xmin, ymax, xmax], where each float is between 0-1, i.e. normalized coordinates (e.g. 0.5 stands for half-way horizontally or vertically on the context panorama). (NB: vertical axis goes from top down).
* landmark_angle_coords (List[List[float]]) Angle coordinates (matched with the bbox coords) – heading, pitch, hfov, vfov.
* heading: In radians, from the Matterport3D y-axis, right is increasing.
* pitch: In radians, from the Matterport3D horizon (xy-plane), up is increasing.
* hfov: Horizontal field-of-view in radians.
* vfov: Vertical field-of-view in radians.
* landmark_source_panos (List[str]) List of panorama IDs corresponding to each landmark.
* landmark_source_pano_indices (List[int]) List of indices of the landmark_source_panos in the corresponding RxR path.

*NB*: The numbers of landmarks and text-spans are the same, i.e. 1 text-span corresponds to 1 landmark.
*NB*: The instruction field contains Marky-generated instructions rather than the original, human-written instructions (which are contained in the published RxR data). The field text_spans (and related fields) correspond to those human-written instructions. We put Marky-generated instructions here in an effort to publish new data which are generated from the landmark data (the primary focus) provided here.

Example (*NB*: for Silver splits. For the RxR-marky_train split, there’s `path_id` field, and there’s no `text_spans` and its related fields):
```
{
  "language": "en",
  "instruction_id": 19930,
  "instruction": "You're starting in a laundry room, facing the   
    railing. Walk out of this laundry room onto the wooden flooring.
    Turn right and go down the hallway toward the end of this hallway.
    ...",
  "split": "train",
  "heading": 1.04, 
  "scan": "1pXnuDYAj8r",
  "text_spans": ["laundry room", "hallway", "railing", "carpet", 
                 "corridor", "office area", "hallway", "painting", ...],
  "text_span_chars_start_indices": [21, 57, 74, 90, 156, 201, ...],  
  "text_span_chars_end_indices": [33, 64, 81, 96, 164, 212, 247, 265, ...],   
  "landmark_bbox_coords": [
    [0.3055555, 0.062690742, 0.80555558, 0.34575980],
    [0.3791666, 0.633478232, 0.79583334, 0.88623034],
    ...],
   "landmark_angle_coords": [
    [-1.85840737, -0.17453292, 1.57079637, 1.57079637],
    [1.63271260, -0.274889349, 1.30899691, 1.30899691],
    ...],
  "landmark_source_panos": ["7d887c096fa64a81a02723f8c283ca16",     
                            "7d887c096fa64a81a02723f8c283ca16", 
                            "6a3fba49106e4a9fb40cd0bf47dd4d46", ...],
  "landmark_source_pano_indices": [0, 0, 1, 1, 2, 5, 6, 3, 6, 6, 9, 9, 10], 
}
```

For the RxR-marky_train split, the data items are much simpler as we only publish the Marky-generated instructions.

* language (str) Language tag, `en`/`hi`/`te` for English/Hindi/Telugu.
* path_id (int) Unique path identifier. Only provided for RxR-marky_train split because for the train/val_seen/val_unseen (silver) this already exists in the original RxR data.
* instruction_id (int) Instruction unique identifier. Maps into `instruction_id` field in the Guide data.
* instruction (str) Instruction text, generated by Marky-mT5. 
* heading (float) Agent’s initial heading.
* scan (str) Scan ID for Matterport3D environment. 
* path (List[str]) List of panorama IDs describing the sampled path.

Statistics. Some statistics on the data:
* `marky_open_train.jsonl`: 315M
* `marky_open_val_seen.jsonl`: 35M
* `marky_open_val_unseen.jsonl`: 52M
* `marky_open_marky_train.jsonl`: 725M
